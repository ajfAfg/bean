#!/usr/bin/env python3

import subprocess as sp
import shutil

import parameters

for (vertex_num, edge_num) in parameters.vertex_nums_edge_nums:
    for delay_time in parameters.delay_times:
        params = list(
            map(lambda x: str(x), [vertex_num, edge_num, delay_time]))

        sp.run(['rebar3', 'escriptize'], stdout=sp.DEVNULL, stderr=sp.STDOUT)
        sp.run(['_build/default/bin/time_required_to_restart',
                'generate-gen-server'] + params)

        sp.run(['rebar3', 'bean'], stdout=sp.DEVNULL, stderr=sp.STDOUT)

        sp.run(['rebar3', 'escriptize'], stdout=sp.DEVNULL, stderr=sp.STDOUT)
        sp.run(['_build/default/bin/time_required_to_restart', 'measure'] + params)

        shutil.rmtree('src/gen_servers')
        shutil.rmtree('src/bean')
